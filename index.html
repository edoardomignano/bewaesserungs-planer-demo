<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>PVC WELT BewÃ¤sserungsplaner Demo v0.9</title>

<style>
/* ===================== BASIC ===================== */
:root{
  --bg:#0b0f14;
  --panel:#121926;
  --text:#e6edf3;
  --muted:#9aa4b2;
  --line:rgba(255,255,255,.08);
  --accent:#4cc9f0;
  --warn:#fbbf24;
  --ok:#34d399;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--text);
}
button,input,select{
  background:#0f1520;
  color:var(--text);
  border:1px solid var(--line);
  border-radius:10px;
  padding:8px 10px;
  font-size:13px;
}
button{cursor:pointer}
button.primary{border-color:rgba(76,201,240,.5)}
button.warn{border-color:rgba(251,191,36,.5)}
button.ok{border-color:rgba(52,211,153,.5)}
.small{font-size:12px;color:var(--muted)}

/* ===================== HEADER ===================== */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
  border-bottom:1px solid var(--line);
}
.title{font-weight:900}
.sub{font-size:12px;color:var(--muted)}

/* ===================== LAYOUT ===================== */
.wrap{
  display:grid;
  grid-template-columns:380px 1fr 340px;
  gap:12px;
  padding:12px;
  height:calc(100vh - 60px);
}
.panel{
  background:var(--panel);
  border:1px solid var(--line);
  border-radius:14px;
  padding:12px;
  overflow:auto;
}

/* ===================== STEPS ===================== */
.step{
  border:1px solid var(--line);
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
  cursor:pointer;
}
.step.active{outline:2px solid rgba(76,201,240,.4)}
.badge{
  font-size:11px;
  padding:3px 8px;
  border-radius:999px;
  border:1px solid var(--line);
}
.badge.ok{border-color:rgba(52,211,153,.6);color:var(--ok)}
.badge.open{border-color:rgba(251,191,36,.6);color:var(--warn)}

/* ===================== CANVAS ===================== */
canvas{
  width:100%;
  height:100%;
  border-radius:12px;
  background:#070a10;
}

/* ===================== BOTTOM BAR ===================== */
#bottomBar{
  position:fixed;
  left:12px;right:12px;bottom:12px;
  background:rgba(18,25,38,.95);
  border:1px solid var(--line);
  border-radius:14px;
  padding:10px 12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:999;
}
</style>
</head>

<body>

<header>
  <div>
    <div class="title">PVC WELT BewÃ¤sserungsplaner <span class="small">v0.9</span></div>
    <div class="sub">Schritt-fÃ¼r-Schritt Â· Regner-Live-Vorschau Â· NÃ¤ssekarte Â· PDF-Export</div>
  </div>
</header>

<div class="wrap">

<!-- ================= LEFT ================= -->
<div class="panel">
  <h3>Schritte</h3>

  <div class="step active">
    <b>1) Bild hochladen</b>
    <div class="small">Grundriss / Gartenplan auswÃ¤hlen</div>
    <input type="file" id="bgFile" accept="image/*">
  </div>

  <div class="step">
    <b>2) MaÃŸstab setzen</b>
    <div class="small">2 Punkte setzen â†’ reale LÃ¤nge eingeben</div>
  </div>

  <div class="step">
    <b>3) Wasserquelle setzen</b>
    <div class="small">Startpunkt (Wasserhahn)</div>
  </div>

  <div class="step">
    <b>4) Zu bewÃ¤ssernde FlÃ¤che markieren</b>
    <div class="small">Polygon zeichnen Â· Doppelklick beendet</div>
  </div>

  <div class="step">
    <b>5) Regner setzen</b>
    <div class="small">Maus halten = Vorschau Â· loslassen = setzen</div>
  </div>

  <div class="step">
    <b>6) Rohre verlegen</b>
    <div class="small">Manuell oder automatisch verbinden</div>
  </div>
</div>

<!-- ================= CENTER ================= -->
<div class="panel">
  <canvas id="canvas"></canvas>
</div>

<!-- ================= RIGHT ================= -->
<div class="panel">
  <h3>Hinweise</h3>
  <div class="small">
    â€¢ Regner nachtrÃ¤glich verschiebbar<br>
    â€¢ Dunkelblau = doppelt bewÃ¤ssert<br>
    â€¢ Strg/Cmd + Z = letzter Regner zurÃ¼ck
  </div>
</div>

</div>

<!-- ================= BOTTOM ================= -->
<div id="bottomBar">
  <div>
    <b>Export</b>
    <div class="small">Materialliste als PDF</div>
  </div>
  <button id="btnPdf" class="primary">ðŸ“„ PDF Materialliste</button>
</div>

<script>
/* ======================================================
   MINIMAL STABILE DEMO-LOGIK (kein Crash, GitHub-safe)
====================================================== */

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resize(){
  const dpr = window.devicePixelRatio || 1;
  canvas.width = canvas.clientWidth * dpr;
  canvas.height = canvas.clientHeight * dpr;
  ctx.setTransform(dpr,0,0,dpr,0,0);
}
window.addEventListener("resize", resize);
resize();

/* Hintergrund */
let bgImg = null;
document.getElementById("bgFile").onchange = e=>{
  const f = e.target.files[0];
  if(!f) return;
  bgImg = new Image();
  bgImg.onload = draw;
  bgImg.src = URL.createObjectURL(f);
};

/* Dummy Regner */
let sprinklers = [];

canvas.addEventListener("click", e=>{
  const r = canvas.getBoundingClientRect();
  sprinklers.push({x:e.clientX-r.left,y:e.clientY-r.top});
  draw();
});

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(bgImg){
    ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);
  }
  sprinklers.forEach(s=>{
    ctx.beginPath();
    ctx.arc(s.x,s.y,60,0,Math.PI*2);
    ctx.fillStyle="rgba(80,160,255,.25)";
    ctx.fill();
    ctx.beginPath();
    ctx.arc(s.x,s.y,4,0,Math.PI*2);
    ctx.fillStyle="#4cc9f0";
    ctx.fill();
  });
}

/* PDF Export (stabil) */
document.getElementById("btnPdf").onclick = ()=>{
  const w = window.open("","_blank");
  w.document.write(`
    <h2>Materialliste (Demo)</h2>
    <p>Regner: ${sprinklers.length}</p>
    <p>Hinweis: Browser â†’ Drucken â†’ Als PDF speichern</p>
    <script>window.print()</script>
  `);
  w.document.close();
};
</script>

</body>
</html>
